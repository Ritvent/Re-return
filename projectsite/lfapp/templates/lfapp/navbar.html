{% load static %}
<nav class="border-b border-border bg-card">
    <div class="container mx-auto px-4">
        <div class="flex h-16 items-center justify-between">
            <div class="flex items-center gap-4">
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="md:hidden p-1.5 rounded-md hover:bg-accent">
                    <i data-lucide="menu" class="h-5 w-5"></i>
                </button>

                <a href="{% url 'home' %}" class="flex items-center gap-2">
                    <i data-lucide="search" class="h-6 w-6 text-primary"></i>
                    <span class="text-xl font-bold text-foreground">Han<span class="text-primary">App</span></span>
                    
                </a>

                <div class="hidden md:flex items-center gap-4 ml-4">
                    <a href="{% url 'home' %}">
                        <button class="px-4 py-2 rounded-md text-sm font-medium transition-all {% if request.resolver_match.url_name == 'home' %}bg-primary text-primary-foreground hover:bg-primary/90{% else %}text-foreground hover:bg-accent hover:text-accent-foreground{% endif %}">
                            Home
                        </button>
                    </a>
                    <a href="{% url 'lost_items' %}">
                        <button class="px-4 py-2 rounded-md text-sm font-medium transition-all {% if request.resolver_match.url_name == 'lost_items' %}bg-primary text-primary-foreground hover:bg-primary/90{% else %}text-foreground hover:bg-accent hover:text-accent-foreground{% endif %}">
                            Lost Items
                        </button>
                    </a>
                    <a href="{% url 'found_items' %}">
                        <button class="px-4 py-2 rounded-md text-sm font-medium transition-all {% if request.resolver_match.url_name == 'found_items' %}bg-primary text-primary-foreground hover:bg-primary/90{% else %}text-foreground hover:bg-accent hover:text-accent-foreground{% endif %}">
                            Found Items
                        </button>
                    </a>
                    <a href="{% url 'claimed_items' %}">
                        <button class="px-4 py-2 rounded-md text-sm font-medium transition-all {% if request.resolver_match.url_name == 'claimed_items' %}bg-primary text-primary-foreground hover:bg-primary/90{% else %}text-foreground hover:bg-accent hover:text-accent-foreground{% endif %}">
                            Claimed Items
                        </button>
                    </a>
                    {% if user.is_authenticated and user.is_admin_user %}
                    <a href="{% url 'admin_dashboard' %}">
                        <button class="px-4 py-2 rounded-md text-sm font-medium transition-all flex items-center gap-2 {% if request.resolver_match.url_name == 'admin_dashboard' %}bg-primary text-primary-foreground hover:bg-primary/90{% else %}text-foreground hover:bg-accent hover:text-accent-foreground{% endif %}">
                            <i data-lucide="shield-user" class="h-4 w-4"></i>
                            Admin
                        </button>
                    </a>
                    {% endif %}
                </div>
            </div>

            <div class="flex items-center gap-4">
                {% if user.is_authenticated %}
                <!-- Post Item Dropdown -->
                {% if user.can_post_items %}
                <div class="relative">
                    <button id="post-menu-btn" class="px-3 py-2 rounded-md bg-primary text-primary-foreground font-medium hover:bg-primary/90 transition-all flex items-center gap-2 text-sm">
                        <i data-lucide="plus" class="h-4 w-4"></i>
                        <span class="hidden sm:inline">Post Item</span>
                    </button>
                    <div id="post-menu" class="hidden absolute right-0 mt-2 w-48 bg-card border rounded-md shadow-xl z-50">
                        <div class="p-2">
                            <a href="{% url 'post_lost' %}" class="flex items-center gap-2 px-4 py-2 rounded-md hover:bg-accent text-sm">
                                Report Lost Item
                            </a>
                            <a href="{% url 'post_found' %}" class="flex items-center gap-2 px-4 py-2 rounded-md hover:bg-accent text-sm">
                                Report Found Item
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- User Menu -->
                <div class="relative">
                    <button id="user-menu-btn" class="rounded-full hover:opacity-80 transition-opacity relative focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                        {% if user.google_profile_picture %}
                            <img src="{{ user.google_profile_picture }}" alt="Profile" class="h-9 w-9 rounded-full object-cover border border-border">
                        {% else %}
                            <div class="h-9 w-9 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-sm border border-border">
                                {{ user.email|make_list|first|upper }}
                            </div>
                        {% endif %}

                        {% if unread_messages_count > 0 %}
                        <span class="absolute top-0 right-0 h-2.5 w-2.5 bg-destructive rounded-full border-2 border-card"></span>
                        {% endif %}
                    </button>
                    <div id="user-menu" class="hidden absolute right-0 mt-2 w-56 bg-card border rounded-md shadow-xl z-50">
                        <div class="p-4 border-b">
                            <p class="font-medium">{{ user.get_full_name|default:user.email }}</p>
                            <p class="text-xs text-muted-foreground">{{ user.email }}</p>
                        </div>
                        <div class="p-2">
                            <a href="{% url 'messages_inbox' %}" class="flex items-center justify-between px-4 py-2 rounded-md hover:bg-accent text-sm">
                                <span class="flex items-center gap-2">
                                    <i data-lucide="mail" class="h-4 w-4"></i>
                                    Messages
                                </span>
                                {% if unread_messages_count > 0 %}
                                <span class="bg-destructive text-white text-xs font-bold px-2 py-0.5 rounded-full">{{ unread_messages_count }}</span>
                                {% endif %}
                            </a>
                            <a href="{% url 'logout' %}" class="flex items-center gap-2 px-4 py-2 rounded-md hover:bg-accent text-sm">
                                <i data-lucide="log-out" class="h-4 w-4"></i>
                                Logout
                            </a>
                        </div>
                    </div>
                </div>
                {% else %}
                <!-- Guest User - Sign In Button -->
                <a href="{% url 'landing' %}">
                    <button class="px-6 py-2 rounded-md bg-primary text-primary-foreground font-medium hover:bg-primary/90 transition-all flex items-center gap-2">
                        <i data-lucide="log-in" class="h-4 w-4"></i>
                        Sign In
                    </button>
                </a>
                {% endif %}
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden border-t border-border py-4">
            <div class="flex flex-col gap-2">
                <a href="{% url 'home' %}" class="px-4 py-2 rounded-md text-sm font-medium transition-all {% if request.resolver_match.url_name == 'home' %}bg-primary text-primary-foreground{% else %}text-foreground hover:bg-accent{% endif %}">
                    Home
                </a>
                <a href="{% url 'lost_items' %}" class="px-4 py-2 rounded-md text-sm font-medium transition-all {% if request.resolver_match.url_name == 'lost_items' %}bg-primary text-primary-foreground{% else %}text-foreground hover:bg-accent{% endif %}">
                    Lost Items
                </a>
                <a href="{% url 'found_items' %}" class="px-4 py-2 rounded-md text-sm font-medium transition-all {% if request.resolver_match.url_name == 'found_items' %}bg-primary text-primary-foreground{% else %}text-foreground hover:bg-accent{% endif %}">
                    Found Items
                </a>
                <a href="{% url 'claimed_items' %}" class="px-4 py-2 rounded-md text-sm font-medium transition-all {% if request.resolver_match.url_name == 'claimed_items' %}bg-primary text-primary-foreground{% else %}text-foreground hover:bg-accent{% endif %}">
                    Claimed Items
                </a>
                {% if user.is_authenticated and user.is_admin_user %}
                <a href="{% url 'admin_dashboard' %}" class="px-4 py-2 rounded-md text-sm font-medium transition-all flex items-center gap-2 {% if request.resolver_match.url_name == 'admin_dashboard' %}bg-primary text-primary-foreground{% else %}text-foreground hover:bg-accent{% endif %}">
                    <i data-lucide="shield-user" class="h-4 w-4"></i>
                    Admin
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>

<script>
    // Toggle dropdown menus
    document.addEventListener('DOMContentLoaded', function() {
        // Mobile Menu
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
            mobileMenuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                mobileMenu.classList.toggle('hidden');
                // Close other menus
                const postMenu = document.getElementById('post-menu');
                const userMenu = document.getElementById('user-menu');
                if (postMenu) postMenu.classList.add('hidden');
                if (userMenu) userMenu.classList.add('hidden');
            });
        }

        // Post Item Menu
        const postMenuBtn = document.getElementById('post-menu-btn');
        const postMenu = document.getElementById('post-menu');
        
        if (postMenuBtn && postMenu) {
            postMenuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                postMenu.classList.toggle('hidden');
                // Close other menus
                const userMenu = document.getElementById('user-menu');
                if (userMenu) userMenu.classList.add('hidden');
                if (mobileMenu) mobileMenu.classList.add('hidden');
            });
        }
        
        // User Menu
        const menuBtn = document.getElementById('user-menu-btn');
        const menu = document.getElementById('user-menu');
        
        if (menuBtn && menu) {
            menuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                menu.classList.toggle('hidden');
                // Close other menus
                if (postMenu) postMenu.classList.add('hidden');
                if (mobileMenu) mobileMenu.classList.add('hidden');
            });
        }
        
        // Close all menus when clicking outside
        document.addEventListener('click', function() {
            if (menu) menu.classList.add('hidden');
            if (postMenu) postMenu.classList.add('hidden');
            if (mobileMenu) mobileMenu.classList.add('hidden');
        });

        // Reinitialize icons after dynamic content loads
        lucide.createIcons();
    });
</script>

